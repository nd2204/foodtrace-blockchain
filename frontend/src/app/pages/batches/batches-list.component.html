<div class="page">
  <header class="page-header">
    <div>
      <h1>{{ 'PAGES.BATCHES.TITLE' | translate }}</h1>
      <p class="page-subtitle">{{ 'PAGES.BATCHES.SUBTITLE' | translate }}</p>
    </div>

    <div class="page-actions">
      <div class="search-box">
        <span class="search-icon">üîç</span>
        <!-- <input -->
        <!--   type="text" -->
        <!--   placeholder="T√¨m ki·∫øm l√¥ h√†ng..." -->
        <!--   [(ngModel)]="searchTerm" -->
        <!-- > -->
        <input type="text" [placeholder]="'COMMON.Search' | translate" [(ngModel)]="searchTerm"
          (keyup.enter)="onSearch()">
      </div>

      <button class="btn-secondary btn-filter" (click)="toggleFilter()" [class.active]="isFilterVisible">
        <span class="icon">üå™Ô∏è</span> {{ 'COMMON.FILTER' | translate }}
      </button>

      <div class="button-group">
        <button class="btn-secondary">{{ 'PAGES.BATCHES.BTN_IMPORT' | translate }}</button>
        <button class="btn-primary" routerLink="/batches/create">
          <span class="icon">Ôºã</span> {{ 'PAGES.BATCHES.BTN_CREATE' | translate }}
        </button>
      </div>
    </div>
  </header>

  <div class="filter-container" *ngIf="isFilterVisible">
    <div class="filter-header">
      <h3>{{ 'COMMON.FILTER' | translate }}</h3>
      <button class="close-filter" (click)="isFilterVisible = false">‚úï</button>
    </div>

    <div class="filter-row">
      <input type="text" class="form-control" placeholder="M√£ l√¥ h√†ng" [(ngModel)]="filter.code">
      <input type="text" class="form-control" placeholder="T√™n s·∫£n ph·∫©m" [(ngModel)]="filter.product">
      <input type="text" class="form-control" placeholder="T√™n n√¥ng tr·∫°i" [(ngModel)]="filter.farm">
      <select class="form-control" [(ngModel)]="filter.status">
        <option value="">-- Tr·∫°ng th√°i --</option>
        <option value="in_farm">T·∫°i n√¥ng tr·∫°i</option>
        <option value="in_transit">ƒêang v·∫≠n chuy·ªÉn</option>
        <option value="delivered">ƒê√£ giao</option>
      </select>
    </div>

    <div class="filter-row">
      <input type="date" class="form-control" title="T·ª´ ng√†y" [(ngModel)]="filter.fromDate">
      <input type="date" class="form-control" title="ƒê·∫øn ng√†y" [(ngModel)]="filter.toDate">
      <div style="flex: 1;"></div>
    </div>

    <div class="filter-actions">
      <button class="btn-reset" (click)="resetFilter()">{{ 'COMMON.RESET' | translate }}</button>
      <button class="btn-search-blue" (click)="onSearch()">{{ 'COMMON.APPLY' | translate }}</button>
    </div>
  </div>

  <table class="table">
    <thead>
      <tr>
        <th>{{ 'PAGES.BATCHES.TH_ID' | translate }}</th>
        <th>{{ 'PAGES.BATCHES.TH_CODE' | translate }}</th>
        <th>{{ 'PAGES.BATCHES.TH_PRODUCT' | translate }}</th>
        <th>{{ 'PAGES.BATCHES.TH_FARM' | translate }}</th>
        <!-- <th>{{ 'PAGES.BATCHES.TH_STATUS' | translate }}</th> -->
        <th>{{ 'PAGES.BATCHES.TH_CREATED' | translate }}</th>
        <th class="text-center">{{ 'COMMON.ACTIONS' | translate }}</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let b of batches">
        <td>{{ b.batch_id }}</td>
        <td><strong>{{ b.batch_number }}</strong></td>
        <td>{{ b.product_name }}</td>
        <td>{{ b.farm_name }}</td>
        <!-- <td><span class="badge" [ngClass]="'badge-status-' + (b.status || 'active')">{{ b.status }}</span></td> -->
        <td>{{ b.created_at | date:'dd/MM/yyyy' }}</td>
        <td class="text-center relative-cell">
          <button class="action-btn" (click)="toggleMenu(b.batch_id, $event)">‚ãÆ</button>
          <div class="action-menu" *ngIf="openDropdownId === (b.batch_id)" (click)="$event.stopPropagation()">
            <button class="menu-item" [routerLink]="['/batches', b.batch_id]">
              üëÅ {{ 'COMMON.VIEW' | translate }}
            </button>
            <button class="menu-item" [routerLink]="['/trace']" [queryParams]="{ batch_number: b.batch_number }">
              üîç {{ 'PAGES.BATCHES.BTN_TRACE' | translate }}
            </button>
          </div>
        </td>
      </tr>

      <!-- <tr *ngIf="batches.length === 0"> -->
      <!--   <td colspan="7" style="text-align: center; padding: 20px; color: #64748b;"> -->
      <!--     Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£ n√†o cho "{{ searchTerm }}" -->
      <!--   </td> -->
      <!-- </tr> -->
    </tbody>
  </table>
</div>
